<h4><%= @heading.name %></h4>

<div class="callout primary">
  <p>The winners for this election were determined using the <strong>Single Transferable Vote (STV)</strong> method.</p>
</div>
<h5>Elected Candidates</h5>
<% if @investments.winners.any? %>
  <table style="background-color: #f9f9f9; border: 1px solid #eee; border-radius: 5px; width: 100%;">
    <tbody>
      <% @investments.winners.each do |winner| %>
        <tr style="border-top: 1px solid #eee;">
          <td style="width: 70px; padding: 10px;">
            <%# Only render an image if one exists, otherwise this cell is empty %>
            <% if winner.image.present? %>
              <%# Use the new :portrait variant %>
              <%= image_tag winner.image.variant(:portrait),
                            alt: winner.title,
                            class: "stv-winner-portrait" %>
            <% end %>
          </td>
          <td style="vertical-align: middle;">
            <span class="icon-check success"></span>
            <%= link_to winner.title, budget_investment_path(@budget, winner) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>There were no winners in this election.</p>
<% end %>

<hr>
<%# Find the STV report document attached to the budget %>
<% stv_report_document = @budget.documents.find_by(title: "STV Full Report") %>

<%# Display the download link if the document exists %>
<% if stv_report_document %>
  <p>
    <%= link_to "Download Full Report (PDF)", 
                rails_blob_path(stv_report_document.attachment, disposition: "attachment"), 
                class: "button" %>
  </p>
<% end %>
<p>For a full breakdown of the results, please see the reports below:</p>
<ul class="menu vertical">
  <li><%= link_to "View Final Results Summary", "/#{@summary_slug}" %></li>
  <li><%= link_to "View Detailed Round-by-Round Log", "/#{@detail_slug}" %></li>
</ul>
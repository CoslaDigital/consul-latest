<%= render Shared::GlobalizeLocalesComponent.new %>

<%# 1. Loop over the groups *outside* of the form tag. %>
<% contents.each do |group| %>

  <hr>
  <%# This title is now outside the form, which is correct %>
  <h3>Editing Group: <%= group.first.key.split('.').first %></h3>

  <%# 2. Start the form *inside* the loop. %>
  <%#    Note the added method: :post %>
  <%= form_tag admin_site_customization_information_texts_path, method: :post do %>

    <%# 3. These tags must be included in *every* form %>
    <% enabled_locales.each do |l| %>
      <%= translation_enabled_tag l, site_customization_enable_translation?(l) %>
    <% end %>

    <%# 4. This hidden field tells the controller which tab to return to %>
    <%= hidden_field_tag :tab, params[:tab] || :basic %>

    <%# 5. The inner loops now only process *one group's* contents %>
    <% group.each do |content| %>
      <%= hidden_field_tag "contents[content_#{content.key}][id]", content.key %>
      <% (content.globalize_locales & enabled_locales.map(&:to_sym)).each do |locale| %>
        <%= render Admin::SiteCustomization::InformationTexts::FormFieldComponent.new(content, locale: locale) %>
      <% end %>
    <% end %>

    <%# 6. The submit tag is inside the loop, saving only this one group %>
    <%= submit_tag t("admin.menu.site_customization.buttons.save"), class: "button" %>
  <% end %> <%# The form ends here %>
<% end %> <%# The main group loop ends here %>